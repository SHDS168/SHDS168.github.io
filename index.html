<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ù–∞–∂–º–∏ –Ω–∞ –∫–≤–∞–¥—Ä–∞—Ç</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    color: white;
    margin: 0;
    padding: 20px;
  }
  h1 { margin: 10px 0; }
  
  #gameArea {
    width: 500px;
    height: 500px;
    margin: 20px auto;
    border: 4px solid white;
    border-radius: 16px;
    position: relative;
    background: rgba(255,255,255,0.1);
    overflow: hidden;
  }
  
  .target {
    position: absolute;
    background: linear-gradient(45deg, #ff4e50, #f9d423);
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    animation: appear 0.3s ease-out;
  }
  
  @keyframes appear {
    from { transform: scale(0); opacity: 0; }
    to   { transform: scale(1); opacity: 1; }
  }
  
  #info { font-size: 22px; margin: 10px 0; }
  #status { font-size: 18px; color: #ffd700; margin: 5px 0; }
  
  .controls {
    margin: 10px 0;
  }
  
  button {
    padding: 12px 30px;
    font-size: 18px;
    margin: 5px;
    border: none;
    border-radius: 10px;
    background: #007bff;
    color: white;
    cursor: pointer;
  }
  button:hover { background: #0056b3; }
  button:disabled { background: #6c757d; cursor: not-allowed; }
  
  #soundBtn.on { background: #28a745; }
  #soundBtn.on:hover { background: #218838; }
</style>
</head>
<body>

<h1>–ù–∞–∂–º–∏ –Ω–∞ –∫–≤–∞–¥—Ä–∞—Ç!</h1>

<div id="info">
  –í—Ä–µ–º—è: <span id="time">60</span> —Å–µ–∫ | –û—á–∫–∏: <span id="score">0</span>
</div>

<div id="status">–ù–∞–∂–º–∏ ¬´–ù–∞—á–∞—Ç—å –∏–≥—Ä—É¬ª</div>

<div class="controls">
  <button id="startBtn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
  <button id="soundBtn" class="on">üîä –ó–≤—É–∫: –í–ö–õ</button>
</div>

<div id="gameArea"></div>

<script>
// Web Audio API –¥–ª—è —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –∑–≤—É–∫–æ–≤
let audioCtx = null;
function initAudio() {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
}

function playPop() {  // –ó–≤—É–∫ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–≤–∞–¥—Ä–∞—Ç–∞
  initAudio();
  if (!audioCtx || audioCtx.state === 'suspended') return;

  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.type = 'sine';
  osc.frequency.setValueAtTime(800, audioCtx.currentTime);
  osc.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.15);

  gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.15);

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + 0.15);
}

function playClick() {  // –ó–≤—É–∫ –∫–ª–∏–∫–∞ / –ø–æ–ø–∞–¥–∞–Ω–∏—è
  initAudio();
  if (!audioCtx || audioCtx.state === 'suspended') return;

  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.type = 'square';
  osc.frequency.setValueAtTime(1200, audioCtx.currentTime);
  osc.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.08);

  gain.gain.setValueAtTime(0.4, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.08);

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + 0.08);
}

// === –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ===
let score = 0;
let timeLeft = 60;
let gameRunning = false;
let timerId = null;
let targetTimeout = null;
let targetElement = null;
let soundsEnabled = true;

// –≠–ª–µ–º–µ–Ω—Ç—ã DOM
const timeEl    = document.getElementById("time");
const scoreEl   = document.getElementById("score");
const statusEl  = document.getElementById("status");
const startBtn  = document.getElementById("startBtn");
const soundBtn  = document.getElementById("soundBtn");
const gameArea  = document.getElementById("gameArea");

// –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∑–≤—É–∫–∞
soundBtn.addEventListener("click", () => {
  soundsEnabled = !soundsEnabled;
  soundBtn.textContent = soundsEnabled ? "üîä –ó–≤—É–∫: –í–ö–õ" : "üîá –ó–≤—É–∫: –í–´–ö–õ";
  soundBtn.className = soundsEnabled ? "on" : "";
});

// –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞—É–¥–∏–æ-–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–≤–∞–∂–Ω–æ –¥–ª—è Web Audio API)
document.body.addEventListener('click', () => {
  initAudio();
  if (audioCtx && audioCtx.state === 'suspended') {
    audioCtx.resume().then(() => {
      console.log("–ê—É–¥–∏–æ-–∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω");
    });
  }
}, { once: true });

// –§—É–Ω–∫—Ü–∏–∏ –∏–≥—Ä—ã
function startGame() {
  if (gameRunning) return;
  
  initAudio();  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

  gameRunning = true;
  score = 0;
  timeLeft = 60;
  scoreEl.textContent = score;
  timeEl.textContent = timeLeft;
  statusEl.textContent = "–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!";
  startBtn.textContent = "–ò–≥—Ä–∞ –∏–¥—ë—Ç...";
  startBtn.disabled = true;
  
  timerId = setInterval(() => {
    timeLeft--;
    timeEl.textContent = timeLeft;
    if (timeLeft <= 0) endGame();
  }, 1000);
  
  spawnTarget();
}

function spawnTarget() {
  if (!gameRunning) return;

  if (targetElement) targetElement.remove();

  targetElement = document.createElement("div");
  targetElement.className = "target";

  const size = Math.floor(Math.random() * 70) + 50;
  const maxX = 500 - size - 20;
  const maxY = 500 - size - 20;

  const x = 10 + Math.floor(Math.random() * maxX);
  const y = 10 + Math.floor(Math.random() * maxY);

  targetElement.style.width  = size + "px";
  targetElement.style.height = size + "px";
  targetElement.style.left   = x + "px";
  targetElement.style.top    = y + "px";

  targetElement.addEventListener("click", hitTarget);
  gameArea.appendChild(targetElement);

  if (soundsEnabled) playPop();  // –°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π pop

  clearTimeout(targetTimeout);
  targetTimeout = setTimeout(spawnTarget, 3000);
}

function hitTarget() {
  if (!gameRunning) return;

  if (soundsEnabled) playClick();  // –°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π –∫–ª–∏–∫

  score++;
  scoreEl.textContent = score;
  statusEl.textContent = "–ü–æ–ø–∞–¥–∞–Ω–∏–µ! +1";

  clearTimeout(targetTimeout);
  setTimeout(spawnTarget, 200);
}

function endGame() {
  gameRunning = false;
  clearInterval(timerId);
  clearTimeout(targetTimeout);

  if (targetElement) {
    targetElement.remove();
    targetElement = null;
  }

  statusEl.textContent = "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!";
  startBtn.textContent = "–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞";
  startBtn.disabled = false;

  setTimeout(() => {
    alert("–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!\n–¢–≤–æ–π —Å—á—ë—Ç: " + score);
  }, 300);
}

startBtn.addEventListener("click", startGame);
</script>

</body>
</html>
